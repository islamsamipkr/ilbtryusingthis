variable "ssl_certificate_self_link" {
  description = "Self link to the regional SSL certificate for ILB"
  type        = string
}

# You'll also need region/project if you create the regional HTTPS proxy in the module:
variable "google_project" { type = string }
variable "region"        { type = string }
# Example: Regional HTTPS proxy for Internal HTTPS LB
resource "google_compute_region_target_https_proxy" "this" {
  name             = "${var.project_name}-ilb-https-proxy"
  project          = var.google_project
  region           = var.region
  url_map          = google_compute_region_url_map.this.self_link
  ssl_certificates = [var.ssl_certificate_self_link]
}

resource "google_compute_region_target_https_proxy" "default" {
  name        = "ilb-target-https-proxy"
  project     = var.project_id
  region      = "us-central1"

  url_map     = google_compute_region_url_map.default.self_link

  # Either full resource name or just .id works:
  certificate_manager_certificates = [
    google_certificate_manager_certificate.default.id
  ]
}

resource "google_certificate_manager_certificate" "default" {
  name     = "my-certificate"
  project  = var.project_id
  location = "us-central1"   # must match the ILB region

  self_managed {
    pem_certificate = file("./cert/fullchain.pem")   # leaf + intermediates
    pem_private_key = file("./cert/privkey.pem")     # unencrypted key
  }
}


